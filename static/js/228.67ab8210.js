"use strict";(self["webpackChunkMSC"]=self["webpackChunkMSC"]||[]).push([[228],{1228:function(a,e,t){t.r(e),t.d(e,{default:function(){return P}});t(4114);var s=t(641),l=t(33),o=t(953),c=t(7043),n=(t(216),t(8982)),i=t(5601),r=t(31),u=t(2141);const v={class:"property"},d={class:"app-head blue"},k={class:"head-left"},m={class:"content"},L={class:"value-info"},f={class:"section-top"},p={class:"income"},h={class:"amount"},b={class:"rest"},g={class:"amount"},w={class:"section-top"},y={class:"rest"},C={class:"process"},K={class:"section-bottom"},S={class:"value"},F={class:"amount"},_={class:"rest"},R={class:"amount"},x={class:"bottom-box"},$={class:"list"},M={class:"cell"},T={class:"left"},W={class:"label"},E={class:"right"},V={class:"time"};var Y=Object.assign({name:"property"},{__name:"index",setup(a){var e=t(5093);(0,c.rd)();const Y=(0,o.KR)([]),H=(0,o.KR)(!1),I=(0,o.KR)(!1),P=(0,o.Kh)({}),X=(0,o.KR)(""),A=(0,o.KR)(0),D=((0,o.KR)(10),(0,o.KR)(0),(0,o.KR)(0),(0,o.KR)(0),(0,o.KR)("")),N=(0,o.Kh)(i.n),U=(0,o.KR)(null),j=(0,o.KR)(!1),z=async()=>{const a=r.b(D.value);await U.value.writeContract("star","unstake",[a]),await B(),await O()},B=async()=>{const a=r.b(D.value);let e=await U.value.readContract("star","lastProfits",[a]),t=u.ck(e);P.lastProfit=parseFloat(t).toFixed(4);let s=await U.value.readContract("star","unstakeTime",[a]);P.unstakeTime=s;let l=await U.value.readContract("star","totalStars",[a]);P.totalStars=parseFloat(u.ck(l)).toFixed(4);let o=await U.value.readContract("star","releaseStars",[a]);P.releaseStars=parseFloat(u.ck(o)).toFixed(4),P.totalStars>0?A.value=100*parseFloat(P.releaseStars)/parseFloat(P.totalStars):A.value=0},O=async()=>{Y.value=[];const a=r.b(D.value),t=await U.value.readContract("star","getUnStackedRecords",[a,10]);for(let s=0;s<t.length;s++){t[s][1];let a=t[s][2],l=t[s][3];Y.value.push({remark:"提取",msc:parseFloat(u.ck(a)).toFixed(4),timestamp:e(1e3*l.toString()).format("YYYY-MM-DD HH:mm:ss")})}},q=async()=>{if(U.value){const a=await U.value.getWalletState();a.isConnected?D.value=a.account:await G()}},G=async()=>{j.value=!0;try{if(U.value){const a=await U.value.connectWallet();D.value=a}}catch(a){console.error("连接钱包失败：",a)}finally{j.value=!1}},J=a=>{D.value=a.account},Q=({key:a,contract:e})=>{console.log(a,"合约初始化成功：",e.target)},Z=({contractKey:a,methodName:e,receipt:t})=>{console.log(`交易成功：${e}`,t)},aa=({scene:a,error:e})=>{console.error(`区块链错误[${a}]：`,e)},ea=a=>a?`${a.slice(0,6)}...${a.slice(-4)}`:"",ta=()=>{const a=document.getElementsByClassName("bottom-box");if(a.length>0){const e=document.body.clientHeight;a[0].style.height=e-a[0].offsetTop-70+"px"}},sa=a=>{let t=e(1e3*a.toString()).add(1,"days").diff(e(),"seconds");t=Math.max(t,0);const s=Math.floor(t/86400);let l=t%86400;const o=Math.floor(l/3600);l%=3600;const c=Math.floor(l/60),n=l%60;let i="";return s>0&&(i+=`${s}天`),(o>0||i)&&(i+=`${o}小时`),(c>0||i)&&(i+=`${c}分钟`),i+=`${n}秒`,console.log(`剩余时间：${i}`),i};return(0,s.sV)(async()=>{await q(),await B(),await O(),ta(),P.unstakeTime>0&&setInterval(()=>{console.log(P.unstakeTime),X.value=sa(P.unstakeTime)},1e3)}),(a,e)=>{const t=(0,s.g2)("el-button"),o=(0,s.g2)("el-progress"),c=(0,s.g2)("van-cell"),i=(0,s.g2)("van-list");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",v,[(0,s.Lk)("div",d,[(0,s.Lk)("span",k,[(0,s.Lk)("i",{class:"el-icon-arrow-left",onClick:e[0]||(e[0]=e=>a.$router.go(-1))}),(0,s.eW)(" "+(0,l.v_)(ea(D.value)),1)]),e[2]||(e[2]=(0,s.Lk)("span",{class:"title white"},"我的收益",-1))]),(0,s.Lk)("div",m,[(0,s.Lk)("section",L,[(0,s.Lk)("div",f,[(0,s.Lk)("div",p,[e[3]||(e[3]=(0,s.Lk)("div",null,"上次收益",-1)),(0,s.Lk)("div",h,(0,l.v_)(P.lastProfit),1)]),(0,s.Lk)("div",b,[e[4]||(e[4]=(0,s.Lk)("div",null,"提取倒计时",-1)),(0,s.Lk)("div",g,(0,l.v_)(X.value),1)])]),(0,s.Lk)("div",w,[e[6]||(e[6]=(0,s.Lk)("div",{class:"income"},null,-1)),(0,s.Lk)("div",y,[(0,s.bF)(t,{type:"primary",size:"mini",onClick:z},{default:(0,s.k6)(()=>[...e[5]||(e[5]=[(0,s.eW)("提现",-1)])]),_:1})])]),(0,s.Lk)("div",C,[(0,s.bF)(o,{percentage:A.value,"stroke-width":12,"show-text":!1},null,8,["percentage"])]),(0,s.Lk)("div",K,[(0,s.Lk)("div",S,[e[7]||(e[7]=(0,s.Lk)("div",{class:"label"},"已释放",-1)),(0,s.Lk)("div",F,(0,l.v_)(P.releaseStars),1)]),(0,s.Lk)("div",_,[e[8]||(e[8]=(0,s.Lk)("div",{class:"label"},"总算力",-1)),(0,s.Lk)("div",R,(0,l.v_)(P.totalStars),1)])])])]),(0,s.Lk)("div",x,[e[11]||(e[11]=(0,s.Lk)("section",{class:"desc"},"提取明细",-1)),(0,s.Lk)("div",$,[(0,s.bF)(i,{modelValue:H.value,"onUpdate:modelValue":e[1]||(e[1]=a=>H.value=a),finished:I.value,"finished-text":"没有更多了"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Y.value,(a,t)=>((0,s.uX)(),(0,s.Wv)(c,{border:!1,key:t},{default:(0,s.k6)(()=>[(0,s.Lk)("div",M,[(0,s.Lk)("div",T,[(0,s.Lk)("div",W,(0,l.v_)(a.remark),1),(0,s.Lk)("div",null,"MSC数量"+(0,l.v_)(a.msc),1)]),e[10]||(e[10]=(0,s.Lk)("div",{class:"center"},[(0,s.Lk)("div",{class:"label"},"状态"),(0,s.Lk)("div",{class:"status"},"已完成")],-1)),(0,s.Lk)("div",E,[e[9]||(e[9]=(0,s.Lk)("div",{class:"label"},"时间",-1)),(0,s.Lk)("div",V,(0,l.v_)(a.timestamp),1)])])]),_:2},1024))),128))]),_:1},8,["modelValue","finished"])])])]),(0,s.bF)(n.A,{ref_key:"blockchainRef",ref:U,config:N,onWalletConnected:J,onContractReady:Q,onTxSuccess:Z,onError:aa},null,8,["config"])],64)}}}),H=t(6262);const I=(0,H.A)(Y,[["__scopeId","data-v-666b3123"]]);var P=I}}]);