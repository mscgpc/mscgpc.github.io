"use strict";(self["webpackChunkMSC"]=self["webpackChunkMSC"]||[]).push([[991],{5991:function(a,e,t){t.r(e),t.d(e,{default:function(){return E}});t(4114);var l=t(641),s=t(33),c=t(953),o=t(7043),n=(t(216),t(8982)),i=t(5601),r=t(31),u=t(2141);const v={class:"product"},d={class:"app-head blue"},k={class:"head-left"},L={class:"content"},f={class:"value-info"},p={class:"section-top"},b={class:"income"},m={class:"amount"},h={class:"section-bottom"},g={class:"value"},y={class:"amount"},F={class:"rest"},K={class:"amount"},C={class:"bottom-box"},R={class:"list"},_={class:"cell"},w={class:"left"},x={class:"label"},S={class:"right"},T={class:"time"};var V=Object.assign({name:"product"},{__name:"index",setup(a){var e=t(5093);(0,o.lq)();const V=(0,c.KR)([]),W=(0,c.KR)(!1),$=(0,c.KR)(!1),E=((0,c.KR)(10),(0,c.KR)(0),(0,c.KR)(0),(0,c.Kh)({})),M=((0,c.KR)([]),(0,c.KR)(0),(0,c.KR)("")),Y=(0,c.Kh)(i.n),H=(0,c.KR)(null),X=(0,c.KR)(!1),A=async()=>{if(H.value){const a=await H.value.getWalletState();a.isConnected?M.value=a.account:await D()}},D=async()=>{X.value=!0;try{if(H.value){const a=await H.value.connectWallet();M.value=a}}catch(a){console.error("连接钱包失败：",a)}finally{X.value=!1}},I=a=>{M.value=a.account},N=({key:a,contract:e})=>{console.log(a,"合约初始化成功：",e.target)},O=({contractKey:a,methodName:e,receipt:t})=>{console.log(`交易成功：${e}`,t)},U=({scene:a,error:e})=>{console.error(`区块链错误[${a}]：`,e)},j=a=>a?`${a.slice(0,6)}...${a.slice(-4)}`:"",q=async()=>{const a=r.b(M.value);let e=await H.value.readContract("star","balanceOf",[a]);E.balance=u.ck(e);let t=await H.value.readContract("star","getUserVip",[a]);E.fullStar=parseFloat(u.ck(t[1])).toFixed(4),E.totalStar=parseFloat(u.ck(t[0]))-parseFloat(u.ck(t[2]))},B=async()=>{V.value=[];const a=r.b(M.value);let t=await H.value.readContract("star","getStarRecords",[a,10]);for(let l=0;l<t.length;l++){let a=t[l][1],s=parseFloat(u.ck(a)).toFixed(4),c=t[l][2],o=t[l][3],n=t[l][4];s=1==n?"+"+s:"-"+s;let i="增加算力";1==o?i="增加算力":2==o?i="推荐奖励":3==o?i="释放算力":4==o&&(i="销毁算力");let r=e(1e3*c.toString()).format("YYYY-MM-DD HH:mm:ss");V.value.push({star:s,starTime:r,starType:i})}};(0,l.sV)(async()=>{await A(),await q(),await B(),z()});const z=()=>{const a=document.getElementsByClassName("bottom-box");if(a.length>0){const e=document.body.clientHeight;a[0].style.height=e-a[0].offsetTop-8+"px"}};return(a,e)=>{const t=(0,l.g2)("van-cell"),c=(0,l.g2)("van-list");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.Lk)("div",v,[(0,l.Lk)("div",d,[(0,l.Lk)("span",k,[(0,l.Lk)("i",{class:"el-icon-arrow-left",onClick:e[0]||(e[0]=e=>a.$router.go(-1))}),(0,l.eW)(" "+(0,s.v_)(j(M.value)),1)]),e[2]||(e[2]=(0,l.Lk)("span",{class:"title white"},"我的算力",-1))]),(0,l.Lk)("div",L,[(0,l.Lk)("section",f,[(0,l.Lk)("div",p,[(0,l.Lk)("div",b,[e[3]||(e[3]=(0,l.Lk)("div",null,"个人算力",-1)),(0,l.Lk)("div",m,(0,s.v_)(parseFloat(E.balance).toFixed(4)),1)])]),(0,l.Lk)("div",h,[(0,l.Lk)("div",g,[e[4]||(e[4]=(0,l.Lk)("div",{class:"label"},"小区有效算力",-1)),(0,l.Lk)("div",y,(0,s.v_)(parseFloat(E.fullStar).toFixed(4)),1)]),(0,l.Lk)("div",F,[e[5]||(e[5]=(0,l.Lk)("div",{class:"label"},"小区总算力",-1)),(0,l.Lk)("div",K,(0,s.v_)(parseFloat(E.totalStar).toFixed(4)),1)])])])]),(0,l.Lk)("div",C,[e[8]||(e[8]=(0,l.Lk)("section",{class:"desc"},"明细",-1)),(0,l.Lk)("div",R,[(0,l.bF)(c,{modelValue:W.value,"onUpdate:modelValue":e[1]||(e[1]=a=>W.value=a),finished:$.value,"finished-text":"没有更多了"},{default:(0,l.k6)(()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(V.value,(a,c)=>((0,l.uX)(),(0,l.Wv)(t,{key:c},{default:(0,l.k6)(()=>[(0,l.Lk)("div",_,[(0,l.Lk)("div",w,[(0,l.Lk)("div",x,(0,s.v_)(a.starType),1),(0,l.Lk)("div",null,(0,s.v_)(a.star),1)]),e[7]||(e[7]=(0,l.Lk)("div",{class:"center"},[(0,l.Lk)("div",{class:"label"},"状态"),(0,l.Lk)("div",{class:"status"},"已完成")],-1)),(0,l.Lk)("div",S,[e[6]||(e[6]=(0,l.Lk)("div",{class:"label"},"时间",-1)),(0,l.Lk)("div",T,(0,s.v_)(a.starTime),1)])])]),_:2},1024))),128))]),_:1},8,["modelValue","finished"])])])]),(0,l.bF)(n.A,{ref_key:"blockchainRef",ref:H,config:Y,onWalletConnected:I,onContractReady:N,onTxSuccess:O,onError:U},null,8,["config"])],64)}}}),W=t(6262);const $=(0,W.A)(V,[["__scopeId","data-v-bb2ec9e2"]]);var E=$}}]);